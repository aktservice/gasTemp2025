# 開発方法と構成・デプロイ方法

- 開発する方へ github のリポジトリ URL を送信します

---

# 必要なモジュール・ツール一覧

---

## Node.js/NPM

- **Node.js**  
  バージョン 18 以上を推奨。  
  [公式サイト](https://nodejs.org/ja/)

- **npm**  
  Node.js に同梱。パッケージ管理・スクリプト実行に使用。

---

## グローバル・ローカル・インストールが必要なツール

- **clasp**  
  Google Apps Script のローカル開発・デプロイ用 CLI。  
  インストール:

  ```sh
  npm install -g @google/clasp

  #npm install -D @google/clasp //<-for local

  ```

  [clasp 公式ドキュメント](https://github.com/google/clasp)

---

## プロジェクト依存パッケージ（`package.json` で管理）

- **esbuild**  
  TypeScript/JS バンドラ。GAS 用コードのビルドに利用。
- **esbuild-gas-plugin**  
  GAS 向けに最適化した esbuild プラグイン。
- **vite**  
  フロントエンドの開発・ビルドツール。
- **@types/google-apps-script**  
  GAS API の型定義。
- **typescript**  
  TypeScript サポート。

### 主要依存パッケージ例

```json
{
  "devDependencies": {
    "esbuild": "^0.18.20",
    "esbuild-gas-plugin": "^2.0.0",
    "vite": "^6.3.5",
    "typescript": "^5.0.0",
    "@types/google-apps-script": "^1.0.59"
  }
}
```

---

## その他

- **Google アカウント**  
  GAS プロジェクトのデプロイ・管理に必要。
- **Git**  
  バージョン管理・GitHub 連携用。

---

## 補足

- 依存パッケージは `npm install` で自動インストールされます。
- clasp の初回セットアップ時は `clasp login` で Google アカウント認証が必要です。
- 詳細なバージョンや追加パッケージは `package.json` を参照してください。

---

## 開発環境のセットアップ

1. **依存パッケージのインストール**

   プロジェクトルートで以下を実行してください。

   ```sh
   npm install
   ```

2. **Google Apps Script (GAS) のセットアップ**

   - clasp をインストールして Google アカウントと紐付けます。
   - `.clasp.json` の設定を確認し、GAS プロジェクトと同期できる状態にしてください。

3. **フロントエンド開発サーバの起動**

   ```sh
   npm run dev
   ```

   - `app/front` ディレクトリ配下で Vite 開発サーバが起動します。
   - `localhost:5173` などで動作確認できます。

4. **バックエンド（GAS）コードのビルド**

   ```sh
   npm run buildbackend
   ```

   - `app/backend/src` の TypeScript コードが `dist/backend.js` にバンドルされます。

5. **フロントエンドのビルド**

   ```sh
   npm run buildfront
   ```

   - `app/front/src` の資産が `dist/` に出力されます。

6. **全体ビルドとデプロイ**

   ```sh
   npm run deploy
   ```

   - GAS 用ファイル・静的ファイル・バンドル済み JS を `dist/` にまとめ、`clasp push` で GAS プロジェクトに反映します。

---

## 開発時のポイント

- **フロントエンド**  
  `app/front/src/main.ts` からエントリ。Vite でホットリロードが利用可能です。

- **バックエンド**  
  `app/backend/src/main.ts` が GAS のエントリーポイントです。`global` オブジェクトに関数を登録しています。

- **静的 HTML テンプレート**  
  `app/backend/src/static/` および `app/front/src/static/` 配下に配置します。

- **型定義**  
  GAS API 用の型は `@types/google-apps-script` で補完されます。

---

## よく使うコマンド

| コマンド             | 説明                             |
| -------------------- | -------------------------------- |
| npm run dev          | フロントエンド開発サーバ起動     |
| npm run build        | フロント・バックエンド両方ビルド |
| npm run deploy       | GAS へ push ＋静的ファイル反映   |
| npm run buildbackend | バックエンド（GAS）だけビルド    |
| npm run buildfront   | フロントエンドだけビルド         |

---

## ディレクトリ・ファイル構成

```
.
├── LICENSE
├── README.md
├── backend
│   └── src
│       ├── appsscript.json
│       ├── main.ts
│       ├── static
│       │   └── static.html
│       └── webapp.ts
└── front
│   ├── other.html
│   ├── index.html
│   └── src
│       ├── module.css
│       ├── module.ts
│       ├── main.ts
│       ├── static
│       │   └── staticfront.html
│       └── style.css
├── develop.md
├── dist
│   ├── static.html
│   ├── appsscript.json
│   ├── backend.js
│   ├── index.html
│   └── staticfront.html
├── esbuild.js
├── node_modules
│
├── nodetest
│   ├── deploy.ts
│   └── index.js
├── package-lock.json
├── package.json
├── todo.md
└─ vite.config.ts

```

---

## 主要関数

- `doGet`  
  Web アプリのエントリポイント

- `otherFunctions`
  その他の関数を記載

---

## ビルド戦略

- **バックエンド（GAS）**

  - `esbuild-gas-plugin` + `esbuild@0.18.20`でバンドル
  - GAS の制約に合わせた出力を生成

- **フロントエンド**

  - Vite（`vite@6.3.5`）で開発・ビルド
  - モダンブラウザ向けに最適化

---

# GAS ウェブアプリのデプロイ手順書 🚀

このドキュメントでは、Google Apps Script (GAS) を使って作成したプログラムをウェブアプリケーションとして公開（デプロイ）する手順を記載します。

---

## : プロジェクトの準備

まず、ウェブアプリの元となる GAS プロジェクトは開発担当者で管理。
(開発済みプロジェクトは配布します)
継続開発が必要ですので開発者を専任願います
実行アカウントに関してはウェブアプリの運用アカウントを使用して下さい
ここから下の説明にある操作は運用アカウントでの操作です

---

## : ウェブアプリとしてデプロイする

プロジェクトページを開きウェブに公開（デプロイ）します。

1.  **デプロイボタンをクリック**:

    - GAS エディタの右上にある青い **「デプロイ」** ボタンをクリックし、ドロップダウンメニューから **「新しいデプロイ」** を選択します。

2.  **デプロイ設定**:

    - 歯車のアイコンの隣にある **「種類の選択」** をクリックし、**「ウェブアプリ」** を選択します。

3.  **詳細設定**:

    - **説明 (Description)**: デプロイの内容がわかるような簡単な説明を入力します（例: `初回リリース`）。（任意）
    - **次のユーザーとしてアプリを実行 (Execute as)**: **「自分（あなたのメールアドレス）」** を選択します。これにより、スクリプトはあなたの権限で実行されます。
    - **アクセスできるユーザー (Who has access)**: **「全員」** を選択します。これにより、URL を知っている人なら誰でもアクセスできるようになります。
      - **注意**: 「全員」に設定すると、Google アカウントを持っていない人も含め、誰でも閲覧可能になります。限定公開したい場合は、「Google アカウントを持つユーザー」や「自分のみ」を選択してください。

4.  **デプロイ実行**:
    - 設定が完了したら、**「デプロイ」** ボタンをクリックします。

---

## : 権限の承認

初めてデプロイするときは、このスクリプトにあなたの Google アカウント情報へのアクセスを許可する必要があります。

1.  **承認を開始**:

    - 「承認が必要です」という画面が表示されたら、**「アクセスを承認」** ボタンをクリックします。

2.  **アカウントを選択**:

    - 公開アカウントの Google アカウントを選択します。

3.  **安全でないアプリの警告**:

    - 「このアプリは Google で確認されていません」という警告が表示されることがあります。これは自作のアプリのため表示されるものです。
    - **「詳細」** をクリックし、一番下に表示される **「（プロジェクト名）に移動（安全ではないページ）」** というリンクをクリックして次に進んでください。

4.  **許可**:
    - 最後に、このアプリが Google アカウントに対して行う操作の許可を求められるので、内容を確認して **「許可」** ボタンをクリックします。

---

## : デプロイ完了と URL の確認

- 完了画面に **ウェブアプリの URL** が表示されます。
- この**ウェブアプリの URL**が各所のアプリとなります
- この URL はいつでも **「デプロイ」 > 「デプロイを管理」** から確認できます。

---

## : コードを更新した場合

コードを修正しただけでは、公開されているウェブアプリには反映されません。変更を反映させるには、**再デプロイ** が必要です。

**下記は URL を変更しない手順です**

1.  **デプロイを管理**:

    - **「デプロイ」** > **「デプロイを管理」** を選択します。

2.  「デプロイを管理」画面が開くと、現在有効なデプロイの一覧が表示されます。
3.  更新したいウェブアプリのデプロイ（通常は一つです）の右側にある **鉛筆アイコン ✏️（編集）** をクリックします。

4.  編集画面が開きます。ここで一番大切な操作を行います。
5.  **「バージョン」** という項目のドロップダウンメニューをクリックし、**「新バージョン」** を選択します。

6.  （任意）「説明」の欄に、今回の変更内容をメモしておくと、後からバージョンの管理がしやすくなるのでおすすめです。

7.  設定が完了したら、右下の **「デプロイ」** ボタンをクリックします。
8.  「デプロイを更新しました」というダイアログが表示されれば、更新作業は成功です！

- ⚠️ **注意：やってはいけない更新方法**

毎回「新しいデプロイ」を選択してはいけません。

これを実行すると、**その都度新しいウェブアプリの URL が発行されてしまいます**。以前共有した URL では、古いコードのまま表示され続けることになってしまいます。

---

## 🚀 変更内容の確認

公開済みのウェブアプリの URL に再度アクセスしてみてください。コードの変更が反映されているはずです。

**もし表示が変わらない場合…**
ブラウザのキャッシュ（古いページの記憶）が原因かもしれません。キーボードで以下の「スーパーリロード」を試してみてください。

- **Windows/Linux**: `Ctrl` + `Shift` + `R`
- **Mac**: `Cmd` + `Shift` + `R`

これで、サーバーから最新の情報を強制的に読み込むことができます。

---
